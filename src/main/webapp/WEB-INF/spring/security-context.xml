<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/security
	http://www.springframework.org/schema/security/spring-security.xsd
	http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- 컨트롤러 빈 생성 -->
	<bean id="customAccessDenied"
		class="com.mini.security.AccessDeniedHandler"></bean>
	<bean id="customLoginSuccess"
		class="com.mini.security.CustomLoginSuccessHandler"></bean>
	<bean id="bcryptPasswordEncoder"
		class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />
	<bean id="customPasswordEncoder"
		class="com.mini.security.PasswordEncoder" />
	<bean id="customUserDetailsService"
		class="com.mini.security.CustomUserDetailsService" />


	<security:http>
		<!-- URL 캐치 -->
		<!-- 누구나! -->
		<security:intercept-url pattern="/notice"
			access="permitAll" />
		<security:intercept-url pattern="/signUpPage"
			access="permitAll" />
		<security:intercept-url pattern="/signUp"
			access="permitAll" />		
		<!-- USER까지! -->
		<security:intercept-url pattern="/surveylist"
			access="hasAnyRole('ROLE_MASTER', 'ROLE_ADMIN', 'ROLE_USER')" />
		<security:intercept-url pattern="/shop"
			access="hasAnyRole('ROLE_MASTER', 'ROLE_ADMIN', 'ROLE_USER')" />
		<security:intercept-url
			pattern="/shop/shopDetail"
			access="hasAnyRole('ROLE_MASTER', 'ROLE_ADMIN', 'ROLE_USER')" />
		<security:intercept-url pattern="/surveydetail"
			access="hasAnyRole('ROLE_MASTER', 'ROLE_ADMIN', 'ROLE_USER')" />
		<security:intercept-url pattern="/gifticonBuy"
			access="hasAnyRole('ROLE_MASTER', 'ROLE_ADMIN', 'ROLE_USER')" />

		<!-- ADMIN까지!(기업 관계자) -->

		<security:intercept-url
			pattern="/survey/surveyUpdatePage"
			access="hasRole('ROLE_ADMIN','ROLE_MASTER')" />
		<security:intercept-url
			pattern="/survey/surveyResult"
			access="hasRole('ROLE_ADMIN','ROLE_MASTER')" />


		<!-- MASTER까지!(서버) -->
		<security:intercept-url
			pattern="/shop/shopUploadPage" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="/noticeUpdatePage" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="/survey/shopUpload" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="survey/shopUpload" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="survey/shopUpdate" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="/survey/shopUpdate" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url pattern="/shopUpdate"
			access="hasRole('ROLE_MASTER')" />
		<security:intercept-url pattern="shopUpdate"
			access="hasRole('ROLE_MASTER')" />
		<security:intercept-url pattern="/shopUpload"
			access="hasRole('ROLE_MASTER')" />
		<security:intercept-url pattern="/shopUpload"
			access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="/survey/shopGoodsUpload" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="survey/shopGoodsUpload" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="/shopGoodsUpload" access="hasRole('ROLE_MASTER')" />
		<security:intercept-url
			pattern="shopGoodsUpload" access="hasRole('ROLE_MASTER')" />

		
		<security:access-denied-handler
			ref="customAccessDenied" />



		<security:form-login login-page="/loginPage"
			username-parameter="member_name" password-parameter="member_password"
			authentication-failure-url="/loginPage?message=error"
			authentication-success-handler-ref="customLoginSuccess"
			default-target-url="/notice" always-use-default-target="true" />
		<security:logout logout-url="/logout" />
	</security:http>

	<security:authentication-manager
		alias="authenticationManager">
		<security:authentication-provider
			user-service-ref="customUserDetailsService">

			<security:password-encoder
				ref="bcryptPasswordEncoder" />
			

		</security:authentication-provider>
	</security:authentication-manager>
</beans>